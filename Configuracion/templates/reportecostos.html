{% extends 'base.html' %}

{% block title %}
    Reporte Completo de Costos
{% endblock %}

{% block content %}
<div class="container mt-4">
    <h2>Reporte Completo de Costos</h2>

    <!-- Formulario para filtrar costos por fecha -->
    <form method="GET" class="form-inline mb-3">
        <div class="form-group mx-2">
            <label for="fecha_inicio">Desde:</label>
            <input type="date" class="form-control" name="fecha_inicio" value="{{ fecha_inicio }}">
        </div>
        <div class="form-group mx-2">
            <label for="fecha_fin">Hasta:</label>
            <input type="date" class="form-control" name="fecha_fin" value="{{ fecha_fin }}">
        </div>
        <button type="submit" class="btn btn-primary mx-2">Generar Reporte</button>
    </form>

    <hr>

    <!-- Mostrar estadísticas -->
    <div class="row">
        <div class="col-md-6">
            <p><strong>Total de costos:</strong> ${{ total_costos.total }}</p>
            <p><strong>Promedio de costos:</strong> ${{ promedio_costos.promedio }}</p>
        </div>
    </div>

    <!-- Gráfica -->
    <div class="row mt-4">
        <div class="col-md-12">
            <canvas id="costosChart"></canvas>
        </div>
    </div>

    <!-- Tabla de costos -->
    <div class="row mt-4">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Nombre</th>
                    <th>Valor</th>
                    <th>Fecha</th>
                    <th>Descripción</th>
                </tr>
            </thead>
            <tbody>
                {% for costo in costos %}
                <tr>
                    <td>{{ costo.id }}</td>
                    <td>{{ costo.nombre }}</td>
                    <td>{{ costo.valor }}</td>
                    <td>{{ costo.fecha }}</td>
                    <td>{{ costo.descripcion }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>

<script>
    // Obtener los datos del contexto
    const fechas = {{ fechas|safe }};
    const valores = {{ valores|safe }};
    
    // Configuración del gráfico
    var ctx = document.getElementById('costosChart').getContext('2d');
    var costosChart = new Chart(ctx, {
        type: 'line',  // Tipo de gráfica
        data: {
            labels: fechas,
            datasets: [{
                label: 'Valor de Costos',
                data: valores,
                borderColor: 'rgba(75, 192, 192, 1)',
                borderWidth: 2,
                fill: false
            }]
        },
        options: {
            responsive: true,
            scales: {
                x: {
                    type: 'time',
                    time: {
                        unit: 'day',
                        displayFormats: {
                            day: 'YYYY-MM-DD'
                        }
                    }
                },
                y: {
                    beginAtZero: true
                }
            }
        }
    });
</script>

{% endblock %}
